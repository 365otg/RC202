<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charles Paris Music: The Ultimate OP-1 Field Guide</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Master your Teenage Engineering OP-1 Field with this comprehensive guide by Charles Paris Music. Explore essential tips, advanced techniques, workflow hacks, and detailed explanations for the synth engines, drum sampler, tape recorder, effects, and sequencers. Your go-to resource for all things OP-1 Field.">
    <meta name="keywords" content="OP-1 Field, Teenage Engineering, OP-1 Guide, OP-1 Tutorial, OP-1 Tips, Synthesizer, Sampler, Tape Recorder, Sequencer, FX, LFO, Music Production, Portable Synth, Sound Design, Workflow, Charles Paris Music, Charles Paris, OP-1 Field guide by Charles Paris">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- jsPDF library for PDF generation -->
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --op1-bg: #1a1a1a;
            --op1-card-bg: #252525;
            --op1-accent-blue: #00A8CC;
            --op1-accent-hover: #00c0e6;
            --op1-accent-ochre: #E6A336;
            --op1-accent-gray: #888888;
            --op1-accent-orange: #FF4500;
            --op1-muted: #4a4a4a;
            --op1-muted-hover: #5a5a5a;
            --op1-text-light: #f0f0f0;
            --op1-text-dark: #a0a0a0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--op1-bg);
            color: var(--op1-text-light);
            padding-top: 2rem;
            padding-bottom: 4rem;
        }

        .card {
            background-color: var(--op1-card-bg);
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.5);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            display: flex;
            flex-direction: column;
        }
        .card:hover {
            transform: translateY(-7px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6);
        }
        .tip-category-button, .header-button {
            background-color: var(--op1-muted);
            color: #ffffff;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            letter-spacing: 0.05em;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out, box-shadow 0.2s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            white-space: nowrap;
        }
        .tip-category-button:hover, .header-button:hover {
            background-color: var(--op1-muted-hover);
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }
        .tip-category-button.active {
            background-color: var(--op1-accent-blue);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
        }
        .tip-item {
            background-color: #333333;
            border-radius: 10px;
            padding: 20px;
            border-left: 5px solid var(--op1-accent-blue);
        }
        .modal {
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 50;
        }
        .modal-content {
            background-color: var(--op1-card-bg);
            border-radius: 16px;
        }
        .close-button {
            color: #F0F0F0;
            font-size: 1.8rem;
            transition: color 0.2s;
        }
        .close-button:hover {
            color: #FF8888;
        }
        /* Removed .search-input and .search-button styles as they are no longer used */
        #download-pdf-button, .more-info-button, #back-to-tip-button {
            background-color: var(--op1-accent-blue);
            color: #ffffff;
            padding: 12px 22px;
            border-radius: 10px;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            border: none;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        #download-pdf-button:hover, .more-info-button:hover, #back-to-tip-button:hover {
            background-color: var(--op1-accent-hover);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }
        .related-tips-container, .suggested-tip-container {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--op1-muted);
        }
        .suggested-tip-box, .related-tip-box {
            background-color: #252525;
            border: 1px solid var(--op1-muted);
            border-left: 5px solid var(--op1-accent-blue);
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        .suggested-tip-box:hover, .related-tip-box:hover {
            background-color: #333;
        }
        .tip-icon {
            margin-right: 12px;
            color: var(--op1-accent-blue);
            font-size: 1.1em;
        }
        .copy-button {
            background-color: var(--op1-muted);
            color: #ffffff;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 500;
            transition: background-color 0.2s ease-in-out;
            margin-top: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        .copy-button:hover {
            background-color: var(--op1-muted-hover);
        }
        footer { border-top: 1px solid var(--op1-muted); padding-top: 2rem; margin-top: 4rem; }
        .footer-link { transition: color 0.2s ease-in-out; color: var(--op1-text-dark); }
        .footer-link:hover { color: var(--op1-accent-blue); }
        h1, h2, h3, h4 { color: var(--op1-text-light); }
        p, li { color: #b0b0b0; }
        .main-title {
            font-weight: 800;
            letter-spacing: -0.05em;
        }
        .combo-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        .combo-table th, .combo-table td {
            border: 1px solid var(--op1-muted);
            padding: 12px;
            text-align: left;
        }
        .combo-table th {
            background-color: var(--op1-muted);
        }
        .combo-key {
            background-color: var(--op1-text-dark);
            color: var(--op1-bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-weight: bold;
        }
        .details-view { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Custom centering for header buttons */
        .header-buttons-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center; /* Centers the buttons */
            gap: 1rem; /* Space between buttons */
            width: 100%;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center px-4">

    <header class="w-full max-w-6xl text-center mb-12 flex flex-col items-center">
        <div class="w-full flex flex-col md:flex-row justify-center items-center gap-4 mb-6">
            <div class="header-buttons-container">
                <button id="op1-licks-button" class="header-button"><i class="fa-solid fa-lightbulb mr-2"></i>OP-1 Licks</button>
                <button id="effects-list-button" class="header-button"><i class="fas fa-sliders mr-2"></i>FX List</button>
                <button id="sequencers-button" class="header-button"><i class="fas fa-wave-square mr-2"></i>Sequencers</button>
                <button id="shortcuts-button" class="header-button"><i class="fas fa-keyboard mr-2"></i>Shortcuts</button>
            </div>
        </div>

        <h1 class="text-4xl sm:text-5xl lg:text-6xl main-title mb-4">Charles Paris OP-1 Field Guide</h1>
        <p class="text-lg sm:text-xl lg:text-2xl text-gray-300">Your pocket companion for the portable wonder.</p>
    </header>

    <main class="w-full max-w-6xl">
        <!-- Search input and button removed -->
        <section class="mb-16 p-6 bg-[#1E1E1E] rounded-lg shadow-xl">
            <h2 class="text-3xl font-bold text-white mb-6 text-center">Essential Tips to Get You Started <i class="fa-solid fa-bolt tip-icon"></i></h2>
            <div id="top-tips-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>

        <div class="mb-12">
            <h3 class="text-2xl font-bold text-center mb-6">Filter by Category</h3>
            <div id="category-filter-container" class="flex flex-wrap justify-center gap-4"></div>
        </div>

        <section id="tips-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10"></section>
        
        <div class="flex justify-center mt-16">
            <button id="download-pdf-button" class="search-button"><i class="fa-solid fa-file-pdf"></i> Download All Tips as PDF</button>
        </div>
    </main>

    <!-- Tip Modal -->
    <div id="tip-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden">
        <div class="modal-content w-full max-w-3xl p-8 relative overflow-y-auto max-h-[90vh]">
            <button id="close-modal" class="close-button absolute top-4 right-4 z-10">&times;</button>
            <div id="main-tip-view">
                <h3 id="modal-title" class="text-3xl font-semibold mb-2"></h3>
                <p id="modal-description" class="text-lg leading-relaxed"></p>
                <p id="modal-source" class="text-sm mt-6"></p>
                <div class="flex flex-wrap gap-2 mt-4">
                    <button id="copy-tip-button" class="copy-button"><i class="fa-solid fa-copy"></i> Copy Tip</button>
                    <button id="more-info-button" class="more-info-button"><i class="fa-solid fa-circle-info"></i> More Info</button>
                </div>
            </div>
            <div id="details-view" class="hidden">
                <h3 id="details-title" class="text-3xl font-semibold mb-2"></h3>
                <div id="details-content" class="text-lg leading-relaxed prose prose-invert max-w-none"></div>
                
                <div id="related-tips-container" class="related-tips-container">
                    <h4 class="text-2xl font-semibold mb-4">Related Tips</h4>
                    <div id="related-tips-list" class="space-y-3"></div>
                </div>

                <div id="suggested-tip-container" class="suggested-tip-container">
                    <h4 class="text-2xl font-semibold mb-4">Suggested Tip</h4>
                    <div id="suggested-tip-box-content"></div>
                </div>
                
                <button id="back-to-tip-button" class="search-button mt-6"><i class="fa-solid fa-arrow-left"></i> Back to Tip</button>
            </div>
        </div>
    </div>
    
    <!-- OP-1 Licks Modal -->
    <div id="op1-licks-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden">
        <div class="modal-content w-full max-w-4xl p-8 relative overflow-y-auto max-h-[90vh]">
            <button id="close-op1-licks-modal" class="close-button absolute top-4 right-4 z-10">&times;</button>
            <h3 class="text-4xl font-semibold mb-6"><i class="fa-solid fa-lightbulb mr-3"></i>OP-1 Licks: 35 Patterns & Ideas</h3>
            <div id="op1-licks-content" class="text-lg leading-relaxed"></div>
        </div>
    </div>
    
    <!-- Effects List Modal -->
    <div id="effects-list-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden">
        <div class="modal-content w-full max-w-4xl p-8 relative overflow-y-auto max-h-[90vh]">
            <button id="close-effects-list-modal" class="close-button absolute top-4 right-4 z-10">&times;</button>
            <h3 class="text-4xl font-semibold mb-6">FX List</h3>
            <input type="search" id="effects-search-input" placeholder="Search effects..." class="search-input mb-6 w-full">
            <div id="effects-list-container" class="text-lg leading-relaxed"></div>
        </div>
    </div>
    
    <!-- Sequencers Modal -->
    <div id="sequencers-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden">
        <div class="modal-content w-full max-w-4xl p-8 relative overflow-y-auto max-h-[90vh]">
            <button id="close-sequencers-modal" class="close-button absolute top-4 right-4 z-10">&times;</button>
            <h3 class="text-4xl font-semibold mb-6">Sequencer Guide</h3>
            <div id="sequencers-container" class="text-lg leading-relaxed"></div>
        </div>
    </div>

    <!-- Shortcuts Modal -->
    <div id="shortcuts-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden">
        <div class="modal-content w-full max-w-4xl p-8 relative overflow-y-auto max-h-[90vh]">
            <button id="close-shortcuts-modal" class="close-button absolute top-4 right-4 z-10">&times;</button>
            <h3 class="text-4xl font-semibold mb-6">Button Combos & Shortcuts</h3>
            <div id="shortcuts-container" class="text-sm leading-relaxed"></div>
        </div>
    </div>

    <footer class="w-full max-w-6xl text-center text-gray-500">
        <p class="mb-4">OP-1 Field Guide by <a href="https://www.charlesparis.com" target="_blank" class="font-bold footer-link">Charles Paris Music</a></p>
        <div class="flex justify-center items-center gap-6 text-2xl">
            <a href="https://teenage.engineering" target="_blank" class="footer-link"><i class="fas fa-globe"></i></a>
            <a href="https://www.youtube.com/c/teenageengineering" target="_blank" class="footer-link"><i class="fab fa-youtube"></i></a>
        </div>
    </footer>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const { jsPDF } = window.jspdf;

        const categories = {
            concepts: { name: "Concepts", icon: 'fa-solid fa-lightbulb' },
            synth: { name: "Synth", icon: 'fa-solid fa-wave-square' },
            drum: { name: "Drum", icon: 'fa-solid fa-drum' },
            tape: { name: "Tape", icon: 'fa-solid fa-tape' },
            mixer: { name: "Mixer", icon: 'fa-solid fa-sliders' },
            sequencer: { name: "Sequencer", icon: 'fa-solid fa-border-all' },
            effects: { name: "Effects", icon: 'fa-solid fa-magic-sparkles' },
            sampling: { name: "Sampling", icon: 'fa-solid fa-microphone-lines' },
            midi_connectivity: { name: "MIDI & Connectivity", icon: 'fa-solid fa-link' },
            pro_tips: { name: "Pro Tips", icon: 'fa-solid fa-star' }
        };

        const tipsData = [
            // --- CONCEPTS ---
            { category: "concepts", title: "The Four Main Modes", description: "The OP-1 workflow is built around four main modes: Synth, Drum, Tape, and Mixer. Press their dedicated keys to switch between them.", source: "Manual p.10", topTip: true, context: "This is the core concept of the OP-1. You select a sound in Synth or Drum mode, record your performance as audio onto the Tape, and then use the Mixer to balance the levels and add master effects. Understanding this signal flow is key to making music on the OP-1.", related: ["Recording to Tape", "Sound Path Overview"] },
            { category: "concepts", title: "Automatic Saving", description: "The OP-1 Field automatically saves your work. There is no 'Save' button. When you power off and on again, everything will be exactly as you left it.", source: "Manual p.8", context: "This feature encourages a fluid, creative process. You don't have to interrupt your flow to save. However, it also means that destructive actions (like recording over tape) are permanent, so be mindful of your work. Use the 'Lift' and 'Drop' tape functions to back up sections before making big changes.", related: ["Lifting and Dropping Audio", "Factory Reset"] },
            { category: "concepts", title: "Using the Help Key", description: "The Help key (speech bubble) is your best friend. Press it in combination with any other key to see a quick overlay explaining that key's function in the current context.", source: "Manual p.12", context: "Instead of memorizing every function, use the Help key to learn contextually. For a deeper dive, press SHIFT + HELP to access the full built-in user guide." },
            { category: "concepts", title: "Sound Path Overview", description: "To see a visual representation of the entire signal flow, press SHIFT + MIXER. This shows how your sound travels from the synth/drum engine, through effects, to tape, and out to the master.", source: "Manual p.84", context: "This screen is invaluable for troubleshooting. If you can't hear something, check the Sound Path screen. A warning symbol will light up on any part of the chain where the level is set to zero, helping you quickly identify the problem." },
            
            // --- SYNTH ---
            { category: "synth", title: "Changing Synth Engines", description: "To select a different synth engine, press SHIFT + T1. Use the Blue encoder to scroll through the list of engines and press T1 or tap the encoder to confirm.", source: "Manual p.18", topTip: true, context: "The T1-T4 keys correspond to the four main pages for any sound. T1 is always the sound engine itself. Holding SHIFT while pressing these keys opens up deeper options, like changing the entire engine or LFO type.", related: ["Loading a Full Preset", "ADSR Envelope"] },
            { category: "synth", title: "Loading a Full Preset", description: "To load a complete sound preset (Engine, Envelope, FX, and LFO), hold SHIFT and press one of the preset keys (1-8). Use the Blue encoder for engine type and Ochre for the preset.", source: "Manual p.16", context: "This is different from just changing the engine (SHIFT + T1). Loading a preset changes all four modules at once, giving you a fully-formed sound instantly. It's the fastest way to explore new sounds." },
            { category: "synth", title: "ADSR Envelope", description: "Press T2 in Synth mode to access the ADSR (Attack, Decay, Sustain, Release) envelope. This shapes the volume of your sound over time.", source: "Manual p.38", context: "A short attack is good for percussive sounds, while a long attack creates a swelling pad. The envelope is fundamental to sound design and turning a raw oscillator into a musical instrument.", related: ["Play Mode Settings"] },
            { category: "synth", title: "Play Mode Settings", description: "In the Envelope screen (T2), press SHIFT to access Play Mode settings. Here you can change from Polyphonic to Mono, and adjust Portamento (glide between notes).", source: "Manual p.39", context: "These settings dramatically change how a patch responds to your playing. Use Mono with Portamento for classic sliding lead lines, or Poly for playing chords." },
            { category: "synth", title: "Modulating with an LFO", description: "Press T4 to activate the LFO (Low Frequency Oscillator) for a sound. Press SHIFT + T4 to change the LFO type and its destination.", source: "Manual p.50", context: "The LFO is the key to adding movement and life to your sounds. You can assign it to almost any parameter, like filter cutoff, pitch, or an effect parameter. Subtle LFO modulation can make a static sound feel organic and dynamic.", related: ["Using Effects (FX)"] },

            // --- DRUM ---
            { category: "drum", title: "Laying Out a Drum Kit", description: "In the Drum Sampler, press any musical key to select it for editing. Use the encoders to set the sample's start and end points for that key. Press the key again to confirm.", source: "Manual p.64", context: "This allows you to chop up a single audio file (like a drum loop or a vocal phrase) and assign different slices to different keys, creating a playable kit from one source.", related: ["Drum Envelope", "Sampling a New Sound"] },
            { category: "drum", title: "Drum Envelope", description: "The Drum Envelope (T2 in Drum mode) is a transient shaper. Use it to control the attack (punch) and release (tail) of your drum sounds.", source: "Manual p.68", context: "This is different from the synth's ADSR envelope. It's specifically designed for percussion. Increase the attack to make a kick drum punchier, or soften it to make a snare less aggressive." },
            { category: "drum", title: "Dbox Drum Synth", description: "The Dbox engine is a dual-oscillator synth for creating your own drum sounds from scratch. Every key on the keyboard represents a unique sound you can edit.", source: "Manual p.66", context: "Instead of using samples, you can synthesize your own kicks, snares, and hi-hats. Hold SHIFT to access the parameters for the second oscillator and the filter." },
            
            // --- TAPE ---
            { category: "tape", title: "Recording to Tape", description: "Select a tape track (T1-T4), find an empty spot, set your input level with the Orange encoder, then hold REC and press PLAY to start recording.", source: "Manual p.70", topTip: true, context: "The tape recorder is the heart of the OP-1. Unlike a sequencer that records MIDI notes, the tape records pure audio. This means once something is recorded, you can't change the notes, but you can manipulate the audio in creative ways like changing the speed or reversing it.", related: ["Lifting and Dropping Audio", "Tape Tricks"] },
            { category: "tape", title: "Lifting and Dropping Audio", description: "Use the LIFT key (scissors) to copy a selection of audio from the tape. Move to a new location and use the DROP key (down arrow) to paste it.", source: "Manual p.72", context: "This is the OP-1's version of copy and paste. It's essential for arranging your song. You can lift a drum loop from track 1, move the tape head, and drop it later in the song on track 2 to build your arrangement.", related: ["Splitting and Joining Takes"] },
            { category: "tape", title: "Splitting and Joining Takes", description: "Use the SPLIT key to cut a recorded take at the playhead's position. To join two adjacent takes into one, place the playhead between them and press SHIFT + SPLIT.", source: "Manual p.72, 74", context: "Splitting is crucial for fine-tuning the timing of your recordings or isolating a single sound. Joining is useful for cleaning up your tape view and grouping parts that belong together." },
            { category: "tape", title: "Overdubbing vs. Punch-in", description: "By default, recording on a track with existing audio will overdub (mix with) the old audio. To punch-in (replace) a section, lift the audio from that section first, then record into the empty space.", source: "General Workflow", context: "Understanding this is key to building layers. Overdubbing is great for adding harmonies or stacking percussion. Punch-in recording is for correcting mistakes or replacing a part entirely." },
            { category: "tape", title: "Tape Tricks", description: "In Tape Mode, keys 1-8 become 'Tape Tricks'. These include setting loop points (1, 2), reversing tape playback (5), and a tempo-synced stutter effect (6).", source: "Manual p.73", context: "These are powerful performance tools. You can create fills with the 'Chop' trick or reverse your entire track for a moment. Experiment with them while your song is playing to create interesting variations." },
            { category: "tape", title: "Change Tape Styles", description: "Press SHIFT + TAPE to open the tape browser. Here you can switch between 8 different tapes and choose from 4 different 'styles' (Studio, Vintage, Porta, Disc) that color the sound.", source: "Manual p.76", context: "Each tape style has a unique character. 'Vintage' might add some hiss and warmth, while 'Studio' is clean. This is a great way to add a specific vibe to your entire track. You can also rename tapes here to keep your projects organized." },
            
            // --- MIXER ---
            { category: "mixer", title: "Mute Tracks in Mixer", description: "In the Mixer (T1), you can mute individual tracks by holding SHIFT and pressing the corresponding track key (T1-T4).", source: "Manual p.78", context: "This is much faster than turning the volume knob down and is essential for arranging and mixing down your track. You can use it to build your song by bringing elements in and out." },
            { category: "mixer", title: "Master EQ and FX", description: "Press MIXER, then T2 for the master EQ or T3 for the master FX. These affect the entire mix coming from all four tape tracks.", source: "Manual p.80, 81", context: "The master EQ and FX are not recorded to the individual tape tracks. They are applied live during playback and when you record the final mixdown. Use them to glue your track together and give it a final polish.", related: ["Recording a Final Mixdown"] },
            { category: "mixer", title: "Master Drive", description: "In the Master Out screen (MIXER -> T4), the Drive parameter adds saturation and compression to your final mix, making it sound louder and more compact.", source: "Manual p.82", context: "A little drive can add warmth and character, but too much can make the mix sound distorted and flat. Use it subtly to add punch and cohesion. The 'Release' parameter controls how the compression 'pumps'." },

            // --- SEQUENCER ---
            { category: "sequencer", title: "Sequencer vs. Tape", description: "Sequencers store note data, not audio. This means you can record a pattern with a sequencer and then change the synth sound that plays the pattern.", source: "Manual p.86", topTip: true, context: "This is a key difference from the tape. Use a sequencer to create a melody or drum pattern, then go to Synth or Drum mode and swap out different presets to see how they sound with your sequence. To commit the sound, you must then record the sequencer's output to the tape.", related: ["Recording to Tape"] },
            { category: "sequencer", title: "Enable a Sequencer", description: "To choose and enable a sequencer, press SHIFT + SEQUENCER key. Select the type with the Blue encoder and press the SEQUENCER key again to activate it.", source: "Manual p.86", context: "Repeatedly pressing the sequencer key (without SHIFT) will toggle the currently selected sequencer on and off. The light on the key indicates if it's active." },
            
            // --- EFFECTS ---
            { category: "effects", title: "Using Effects (FX)", description: "Press T3 in Synth or Drum mode to access the FX page. Press SHIFT + T3 to change the effect type. The effect is part of the sound and gets recorded to tape.", source: "Manual p.40", context: "Effects are crucial for sound design. They can be simple (like a delay) or transformative (like the CWO). Remember that the FX you choose is saved with your sound preset.", related: ["Modulating with an LFO"] },
            
            // --- SAMPLING ---
            { category: "sampling", title: "Sampling a New Sound", description: "In Synth or Drum sampler, press the INPUT key (mic icon). Select your source (mic, line in, radio, or internal resampling) and set the threshold. Hold any musical key to start sampling.", source: "Manual p.36, 106", topTip: true, context: "Once you release the key, the recording stops and is immediately playable on the keyboard. This fast, intuitive workflow is what makes sampling on the OP-1 so fun. Use the encoders to trim the start/end points after recording." },
            { category: "sampling", title: "Internal Resampling (EAR)", description: "In the input selection screen (SHIFT + INPUT), choose the 'EAR' icon. This allows you to record whatever is currently coming out of the OP-1's main output back into the sampler.", source: "Manual p.106", context: "This is an incredibly powerful technique. You can play a chord, add effects and LFO, and then resample that entire sound as a new sample. This allows you to create complex, layered sounds that would be impossible to make otherwise." },

            // --- MIDI & CONNECTIVITY ---
            { category: "midi_connectivity", title: "MTP File Transfer", description: "Connect your OP-1 to a computer via USB-C. Hold SHIFT and press COM, then press T4 (MTP). The OP-1 will appear as a device on your computer for transferring audio files.", source: "Manual p.112, 119", context: "This is how you back up your tapes and presets, or load new samples onto the device. You can drag and drop audio files directly into the 'synth' or 'drum' folders to use them as presets." },
            { category: "midi_connectivity", title: "FM Radio Transmitter", description: "Press the OUTPUT key and select the antenna icon. You can now broadcast the OP-1's audio on an FM frequency to a nearby radio (like the OB-4 or a car stereo).", source: "Manual p.110", context: "This is a unique feature for sharing your music wirelessly. The OP-1 will scan for open frequencies to minimize interference. You can even sync the frequency with a nearby OB-4." },
            { category: "midi_connectivity", title: "Recording a Final Mixdown", description: "Press the OUTPUT key and select the mixdown screen. Press T4 to start recording your performance. When finished, press T2 to stop. The final stereo file is found in the 'mixdown' folder via MTP.", source: "Manual p.108", context: "This records everything you hear from the main output, including master EQ, FX, and live manipulations. It's the primary way to export a finished song as a single stereo file." },

            // --- PRO TIPS ---
            { category: "pro_tips", title: "Nudge Tempo", description: "In the Tempo screen, you can use the LEFT and RIGHT arrow keys to temporarily nudge the tempo up or down. This is great for syncing with a live musician by ear.", source: "Manual p.96", context: "Unlike changing the BPM directly, nudging is temporary and helps you get back in time without stopping the music. It's a subtle but powerful feature for live performance." },
            { category: "pro_tips", title: "Save a Sound Snapshot", description: "To quickly save the current state of a sound you're working on, just hold its preset key (1-8) for three seconds. A snapshot will be saved to the 'snapshot' folder.", source: "Manual p.118", context: "This is faster than going through MTP mode to save a patch. It's perfect for when you've tweaked a sound into something you love and want to save it immediately without interrupting your creative flow." },
            { category: "pro_tips", title: "Delayed Power Off", description: "To prevent accidentally turning off your OP-1, go to the settings menu (SHIFT + TEMPO), select System, and set 'Power Off' to 'Delayed'.", source: "Manual p.103", context: "This simple change can save you from the heartache of bumping the power switch during a performance. With this setting, you'll have to hold the switch down for a moment to power off." },
            { category: "pro_tips", title: "Lift/Drop to Backup Tape", description: "Before making a risky change (like recording over a whole track), you can back up your entire tape. Set a loop around the whole song, press SHIFT + LIFT to copy all 4 tracks. If you make a mistake, you can use DROP to paste the backup back.", source: "General Workflow", context: "This is the OP-1 equivalent of 'Save As...'. It gives you a temporary backup in memory, providing a safety net for destructive editing or recording." }
        ];
        const op1LicksData = [
            { title: "Classic Arp Up", sequencer: "Arpeggio", description: "Hold down a chord and let the Arpeggio sequencer play the notes upwards." },
            { title: "Random Melody", sequencer: "Endless", description: "Record a series of random notes into Endless. Set the play mode to 'random' for generative melodies." },
            { title: "Percussive Loop", sequencer: "Finger", description: "Tap out a rhythmic pattern on the drum sampler using the Finger sequencer. Experiment with different drum sounds." },
            { title: "Gliding Bass", sequencer: "Arpeggio", description: "Use a synth patch with high portamento. Play a bassline with the arpeggiator for smooth glides between notes." },
            { title: "Stutter Effect", sequencer: "Pattern", description: "Record a short, percussive sound. In Pattern, draw a very short, repeating pattern to create a stutter effect." },
            { title: "Chord Progression", sequencer: "Hold", description: "Hold down a chord with the Hold sequencer, then play a melody over it manually or with another sequencer." },
            { title: "Random Drum Fills", sequencer: "Tombola", description: "Assign different drum sounds to the Tombola sequencer. Adjust bounciness and speed for chaotic fills." },
            { title: "Ambient Pad Swells", sequencer: "Sketch", description: "Draw long, slow lines in Sketch with a pad sound. Experiment with different LFOs and effects for evolving textures." },
            { title: "Gated Arp", sequencer: "Arpeggio", description: "Combine the Arpeggio with a gate effect (like CWO's filter) to create a rhythmic, choppy arpeggio." },
            { title: "Sidechain Pumping", sequencer: "Punch", description: "Use the Punch effect on a track and automate its 'Power' parameter with a sequencer to create a sidechain-like pumping effect." },
            { title: "Drone with LFO", sequencer: "Endless", description: "Record a single sustained note into Endless. Then, heavily modulate the synth's filter with an LFO for an evolving drone." },
            { title: "Reverse Percussion", sequencer: "Finger", description: "Record a drum pattern. Lift it from tape, reverse it, and drop it back for unique reversed percussion." },
            { title: "Tape Stop Effect", sequencer: "Tape Tricks", description: "Use the 'Stop' tape trick (key 3 or 4) to create a classic tape stop effect on your playing." },
            { title: "Wobbly Synth Bass", sequencer: "Arpeggio", description: "Use a synth with a sine wave, apply an LFO to pitch, and arpeggiate for a classic wobbly bassline." },
            { title: "Glitchy Vocal Chops", sequencer: "Finger", description: "Sample a vocal phrase. Chop it into small pieces and assign to keys. Use Finger to trigger them rapidly for glitchy vocal chops." },
            { title: "Random Chord Generator", sequencer: "Tombola", description: "Assign different chord samples to Tombola. Let it randomly trigger chords for unexpected harmonies." },
            { title: "Rhythmic Noise", sequencer: "Pattern", description: "Use a noise synth engine. Record rhythmic patterns in Pattern for industrial textures." },
            { title: "Melodic Feedback", sequencer: "Delay", description: "Use a delay effect with high feedback. Play a short melody, then let the delay self-oscillate and create new melodic phrases." },
            { title: "Warped Tape Loops", sequencer: "Tape Tricks", description: "Record a loop, then use tape tricks like 'Chop' (key 6) or 'Reverse' (key 5) to mangle it in real-time." },
            { title: "Swelling Pads", sequencer: "Hold", description: "Hold a chord with the Hold sequencer and use a synth with a slow attack and long release for evolving pad sounds." },
            { title: "Broken Arp", sequencer: "Arpeggio", description: "Set the Arpeggio to 'random' or 'up/down' and occasionally skip notes for a broken, unpredictable feel." },
            { title: "Walking Bassline", sequencer: "Endless", description: "Use Endless to record a walking bassline over a chord progression. Its ability to hold many notes makes it ideal for longer, non-repeating phrases." },
            { title: "Finger Drumming Retrigger", sequencer: "Finger", description: "Use Finger's 'retrigger' play mode. Now, holding down a key will repeat that drum sound at a set rhythm, great for trap-style hi-hats or drum rolls." },
            { title: "Delayed Arp", sequencer: "Arpeggio", description: "Use a synth patch with a long attack. Now when you use the arpeggiator, the notes will swell into each other creating a soft, pad-like texture." },
            { title: "Polyrhythmic Pattern", sequencer: "Pattern", description: "Record a 4/4 kick and snare pattern. Then, switch to a different sound and record a 7-step pattern for a hi-hat. They will loop at different rates, creating a polyrhythm." },
            { title: "Generative Ambience", sequencer: "Sketch", description: "In Sketch, draw a few random points. Set the play mode to 'free' and let it generate evolving ambient textures." },
            { title: "Random Percussion", sequencer: "Tombola", description: "Load various percussion samples into Tombola. Set bounciness high and speed low for sparse, random hits." },
            { title: "Lo-Fi Tape Hiss", sequencer: "Tape", description: "Record silence to tape, then apply the 'Vintage' tape style and a lo-fi effect for authentic tape hiss." },
            { title: "Chopped Sample Loop", sequencer: "Finger", description: "Sample a melodic phrase. Chop it into small segments and assign to keys. Finger drum a new melody from the chopped parts." },
            { title: "Pitch-Shifted Drums", sequencer: "Drum", description: "Apply a Pitch Shift effect to your drum kit. Record a pattern, then change the pitch of the entire kit in real-time." },
            { title: "Automated Filter Sweeps", sequencer: "LFO", description: "Assign an LFO to a filter cutoff. Record a sequence, then automate the LFO's rate or depth for dynamic filter sweeps." },
            { title: "Reverse Delay", sequencer: "Delay", description: "Use a delay effect. Record a sound, then reverse the tape. The delay will now play forward while the original sound plays backward." },
            { title: "Gated Reverb", sequencer: "Reverb", description: "Apply a Reverb effect. Then, use a sequencer to quickly gate the track's volume, creating a classic gated reverb sound." },
            { title: "Granular Textures", sequencer: "Granular", description: "Use the Granular synth engine or Granular Delay effect. Experiment with parameters to create evolving, shimmering textures." },
            { title: "Polyphonic Finger Fun", sequencer: "Finger", description: "Finger is polyphonic. Record a bassline, then without erasing, record chords over the top on a different part of the keyboard." },
            { title: "Tombola Drone", sequencer: "Tombola", description: "Set bounciness and speed to zero. The notes will just stick to the walls and play continuously. Use this with pad sounds for a strange, shifting drone." },
            { title: "Sketching Rhythms", sequencer: "Sketch", description: "Use Sketch with a drum kit. Draw vertical lines to trigger multiple sounds at once (a chord of drums), and horizontal lines for rhythmic patterns." },
            { title: "Hold for Layering", sequencer: "Hold", description: "Use Hold to sustain a pad chord, leaving your hands free to play a melody on top with another sound, which you can then record to tape." },
            { title: "Arp Direction Change", sequencer: "Arpeggio", description: "Automate the Arpeggio direction. Record the arp playing 'UP', then lift and drop a section, and change the direction to 'DOWN' for a dynamic arpeggio." }
        ];
        const effectsListData = {
            "CWO": { description: "A complex effect that combines a filter, a crusher, and a tremolo, creating unique sonic textures.", params: ["Filter", "Crush", "Tremolo", "Mix"], source: "Manual p.41" },
            "Delay": { description: "Adds echoes to the sound, creating a sense of space and repetition.", params: ["Time", "Feedback", "Mix"], source: "Manual p.42" },
            "Grid": { description: "A rhythmic effect that slices and dices the audio, creating choppy, glitchy patterns.", params: ["Rate", "Depth", "Pattern", "Mix"], source: "Manual p.43" },
            "Mother": { description: "A cavernous, otherworldly reverb with gating and filtering.", params: ["Distance", "Gate", "Color", "Mix"], source: "Manual p.44" },
            "Nitro": { description: "A dual band-pass filter with resonance and frequency following.", params: ["Lows", "Highs", "Freq Follow", "Q (Resonance)"], source: "Manual p.45" },
            "Phone": { description: "A lo-fi effect that simulates talking through various telephone and radio devices.", params: ["Tone", "GSM", "Baud", "Telemetry"], source: "Manual p.46" },
            "Punch": { description: "A powerful compressor/saturator that adds punch and character to sounds.", params: ["Frequency", "Punch", "Rounds", "Power"], source: "Manual p.47" },
            "Spring": { description: "A classic spring reverb simulation, great for bouncy, metallic textures.", params: ["Tone", "Turns", "Damping", "Mix"], source: "Manual p.48" }
        };
        const sequencersData = {
            "Arpeggio": { description: "Takes the notes you hold and plays them one after another in various patterns.", source: "Manual p.88" },
            "Finger": { description: "Records your finger drumming or key presses directly, capturing the nuances of your performance.", source: "Manual p.90" },
            "Endless": { description: "A generative sequencer that continuously evolves patterns based on your input, great for ambient textures.", source: "Manual p.92" },
            "Pattern": { description: "A step sequencer for creating precise rhythmic and melodic patterns.", source: "Manual p.94" },
            "Tombola": { description: "A unique physics-based sequencer where notes bounce around a virtual drum, creating random yet musical patterns.", source: "Manual p.98" },
            "Sketch": { description: "Allows you to draw patterns freely on the screen, translating your drawings into musical sequences.", source: "Manual p.100" },
            "Hold": { description: "A simple sequencer that sustains notes or chords, freeing your hands for other tasks.", source: "Manual p.102" }
        };
        const shortcutsData = [
            { combo: "SHIFT + T1", description: "Change Synth Engine.", category: "Synth" },
            { combo: "SHIFT + T2", description: "Access Play Mode settings (Poly/Mono, Portamento).", category: "Synth" },
            { combo: "SHIFT + T3", description: "Change Effect Type.", category: "Synth/Drum" },
            { combo: "SHIFT + T4", description: "Change the LFO type.", category: "Synth/Drum" },
            { combo: "HELP + (any key)", description: "Show contextual help for that key.", category: "Global" },
            { combo: "SHIFT + HELP", description: "Open the built-in user guide.", category: "Global" },
            { combo: "REC + PLAY", description: "Start recording to the armed track.", category: "Tape" },
            { combo: "SHIFT + REC", description: "Arm recording without starting playback.", category: "Tape" },
            { combo: "SHIFT + LIFT", description: "Lift audio from all 4 tracks within a loop.", category: "Tape" },
            { combo: "SHIFT + SPLIT", description: "Join two adjacent audio takes.", category: "Tape" },
            { combo: "SHIFT + (Arrow Keys)", description: "Jump between beat markers on the tape.", category: "Tape" },
            { combo: "SHIFT + TAPE", description: "Open the Tape Browser to switch tapes and styles.", category: "Tape" },
            { combo: "SHIFT + MIXER", description: "View the Sound Path diagram.", category: "Mixer" },
            { combo: "SHIFT + SEQUENCER", description: "Choose and enable a sequencer.", category: "Sequencer" },
            { combo: "SHIFT + INPUT", description: "Select input source for sampling (Mic, Line In, Radio, EAR).", category: "Sampling" },
            { combo: "SHIFT + COM", description: "Access MTP file transfer mode.", category: "MIDI & Connectivity" },
            { combo: "SHIFT + TEMPO", description: "Access System settings.", category: "Global" },
            { combo: "LEFT/RIGHT Arrow Keys (in Tempo screen)", description: "Nudge tempo up/down.", category: "Pro Tips" },
            { combo: "(Preset Key 1-8) (Hold 3s)", description: "Save current sound as a snapshot.", category: "Pro Tips" }
        ];

        let currentCategory = 'all';
        let currentTip = null;

        // DOM Elements
        const tipsContainer = document.getElementById('tips-container');
        const topTipsContainer = document.getElementById('top-tips-container');
        const categoryFilterContainer = document.getElementById('category-filter-container');
        const closeModalButton = document.getElementById('close-modal');
        const tipModal = document.getElementById('tip-modal');
        const mainTipView = document.getElementById('main-tip-view');
        const modalTitle = document.getElementById('modal-title');
        const modalDescription = document.getElementById('modal-description');
        const modalSource = document.getElementById('modal-source');
        const copyTipButton = document.getElementById('copy-tip-button');
        const moreInfoButton = document.getElementById('more-info-button');
        const detailsView = document.getElementById('details-view');
        const detailsTitle = document.getElementById('details-title');
        const detailsContent = document.getElementById('details-content');
        const backToTipButton = document.getElementById('back-to-tip-button');
        const detailsRelatedList = document.getElementById('related-tips-list');
        const suggestedTipContainer = document.getElementById('suggested-tip-container');
        const suggestedTipBoxContent = document.getElementById('suggested-tip-box-content');
        // searchInput and searchButton are removed from HTML, so no need to get them here.
        const downloadPdfButton = document.getElementById('download-pdf-button');

        // Header Modal Buttons and Content Areas
        const op1LicksButton = document.getElementById('op1-licks-button');
        const op1LicksModal = document.getElementById('op1-licks-modal');
        const closeOp1LicksModalButton = document.getElementById('close-op1-licks-modal');
        const op1LicksContent = document.getElementById('op1-licks-content');

        const effectsListButton = document.getElementById('effects-list-button');
        const effectsListModal = document.getElementById('effects-list-modal');
        const closeEffectsListModalButton = document.getElementById('close-effects-list-modal');
        const effectsListContainer = document.getElementById('effects-list-container');
        const effectsSearchInput = document.getElementById('effects-search-input'); // This one remains for modal-specific search

        const sequencersButton = document.getElementById('sequencers-button');
        const sequencersModal = document.getElementById('sequencers-modal');
        const closeSequencersModalButton = document.getElementById('close-sequencers-modal');
        const sequencersContainer = document.getElementById('sequencers-container');

        const shortcutsButton = document.getElementById('shortcuts-button');
        const shortcutsModal = document.getElementById('shortcuts-modal');
        const closeShortcutsModalButton = document.getElementById('close-shortcuts-modal');
        const shortcutsContainer = document.getElementById('shortcuts-container');


        // --- HELPER FUNCTIONS ---
        const getIconHtml = (categoryKey) => {
            return categories[categoryKey] ? `<i class="${categories[categoryKey].icon} mr-2"></i>` : '';
        };

        // --- DISPLAY FUNCTIONS ---
        const displayTips = (filter = 'all') => { // Removed searchTerm parameter
            tipsContainer.innerHTML = '';
            topTipsContainer.innerHTML = '';
            // No lowerCaseSearchTerm needed here as main search is removed
            const filteredTips = tipsData.filter(tip => {
                const categoryMatch = (filter === 'all' || tip.category === filter);
                // searchMatch is always true now for main display
                return categoryMatch;
            });
            
            filteredTips.forEach(tip => {
                const card = document.createElement('div');
                card.className = 'card p-6 cursor-pointer';
                card.innerHTML = `
                    <div class="flex-grow">
                        <h4 class="text-xl font-bold mb-2 flex items-center">${getIconHtml(tip.category)} ${tip.title}</h4>
                        <p class="text-gray-400">${tip.description}</p>
                    </div>
                    <p class="text-xs text-gray-500 mt-4 self-start">${categories[tip.category].name}</p>
                `;
                card.onclick = () => openModal(tip);

                if (tip.topTip) {
                    topTipsContainer.appendChild(card);
                } else {
                    tipsContainer.appendChild(card);
                }
            });
        };

        const setupCategoryFilters = () => {
            categoryFilterContainer.innerHTML = '';
            const allButton = document.createElement('button');
            allButton.className = 'tip-category-button active';
            allButton.textContent = 'All';
            allButton.dataset.category = 'all';
            categoryFilterContainer.appendChild(allButton);
            
            for (const key in categories) {
                const button = document.createElement('button');
                button.className = 'tip-category-button';
                button.innerHTML = `<i class="${categories[key].icon} mr-2"></i> ${categories[key].name}`;
                button.dataset.category = key;
                categoryFilterContainer.appendChild(button);
            }
            categoryFilterContainer.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
                    const button = e.target.closest('button');
                    currentCategory = button.dataset.category;
                    document.querySelectorAll('.tip-category-button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    displayTips(currentCategory); // No search term passed
                }
            });
        };

        // --- MODAL LOGIC ---
        const openModal = (tip) => {
            currentTip = tip;
            
            mainTipView.style.display = 'block';
            detailsView.style.display = 'none';
            
            modalTitle.textContent = tip.title;
            modalDescription.textContent = tip.description;
            modalSource.textContent = tip.source ? `Source: ${tip.source}` : '';
            tipModal.classList.remove('hidden');
        };

        const showDetailsView = () => {
            mainTipView.style.display = 'none';
            detailsView.style.display = 'block';
            detailsView.classList.add('details-view');
            detailsTitle.textContent = currentTip.title;
            detailsContent.innerHTML = `<p>${currentTip.context}</p>`;

            // Populate related tips
            detailsRelatedList.innerHTML = '';
            if (currentTip.related && currentTip.related.length > 0) {
                document.getElementById('related-tips-container').style.display = 'block';
                currentTip.related.forEach(relatedTitle => {
                    const relatedTip = tipsData.find(t => t.title === relatedTitle);
                    if (relatedTip) {
                        const tipEl = document.createElement('div');
                        tipEl.className = 'related-tip-box';
                        tipEl.innerHTML = `<strong>${relatedTip.title}:</strong> ${relatedTip.description}`;
                        tipEl.onclick = () => {
                            // Close current modal and open the new one
                            tipModal.classList.add('hidden');
                            setTimeout(() => openModal(relatedTip), 50);
                        };
                        detailsRelatedList.appendChild(tipEl);
                    }
                });
            } else {
                document.getElementById('related-tips-container').style.display = 'none';
            }

            // Populate suggested tip (random from remaining tips)
            const remainingTips = tipsData.filter(t => t !== currentTip && (!currentTip.related || !currentTip.related.includes(t.title)));
            if (remainingTips.length > 0) {
                document.getElementById('suggested-tip-container').style.display = 'block';
                const suggestedTip = remainingTips[Math.floor(Math.random() * remainingTips.length)];
                const suggestedTipEl = document.createElement('div');
                suggestedTipEl.className = 'suggested-tip-box';
                suggestedTipEl.innerHTML = `<strong>${suggestedTip.title}:</strong> ${suggestedTip.description}`;
                suggestedTipEl.onclick = () => {
                    tipModal.classList.add('hidden');
                    setTimeout(() => openModal(suggestedTip), 50);
                };
                suggestedTipBoxContent.innerHTML = ''; // Clear previous content
                suggestedTipBoxContent.appendChild(suggestedTipEl);
            } else {
                document.getElementById('suggested-tip-container').style.display = 'none';
            }
        };

        const hideDetailsView = () => {
            mainTipView.style.display = 'block';
            detailsView.style.display = 'none';
            detailsView.classList.remove('details-view');
        };

        const closeModal = () => {
            tipModal.classList.add('hidden');
            hideDetailsView();
        };

        // --- OTHER MODAL POPULATION ---
        const populateOp1Licks = () => {
            op1LicksContent.innerHTML = op1LicksData.map(lick => `
                <div class="tip-item mb-4">
                    <h4 class="text-xl font-bold text-white">${lick.title}</h4>
                    <p class="text-sm text-gray-400 mb-2">Sequencer: ${lick.sequencer}</p>
                    <p>${lick.description}</p>
                </div>
            `).join('');
        };

        const populateEffectsList = (searchTerm = '') => {
            const lowerCaseSearchTerm = searchTerm.toLowerCase();
            effectsListContainer.innerHTML = Object.entries(effectsListData)
                .filter(([name, data]) => name.toLowerCase().includes(lowerCaseSearchTerm) ||
                                         data.description.toLowerCase().includes(lowerCaseSearchTerm))
                .map(([name, data]) => `
                    <div class="tip-item mb-4">
                        <h4 class="text-xl font-bold text-white">${name}</h4>
                        <p>${data.description}</p>
                        ${data.params.length > 0 ? `<p class="text-sm text-gray-500 mt-2">Parameters: ${data.params.join(', ')}</p>` : ''}
                    </div>
                `).join('');
        };
        
        const populateSequencers = () => {
            sequencersContainer.innerHTML = Object.entries(sequencersData).map(([name, data]) => `
                <div class="tip-item mb-4">
                    <h4 class="text-xl font-bold text-bold">${name}</h4>
                    <p class="text-sm text-gray-400 mb-2">Source: ${data.source}</p>
                    <p>${data.description}</p>
                </div>
            `).join('');
        };

        const populateShortcuts = () => {
            shortcutsContainer.innerHTML = `
                <table class="combo-table">
                    <thead>
                        <tr>
                            <th>Key Combination</th>
                            <th>Action</th>
                            <th>Category</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${shortcutsData.map(shortcut => `
                            <tr>
                                <td><span class="combo-key">${shortcut.combo.replace(/\+/g, '+</span> <span class="combo-key">')}</span></td>
                                <td>${shortcut.description}</td>
                                <td>${shortcut.category}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        };

        // --- PDF DOWNLOAD ---
        const downloadPdf = () => {
            const doc = new jsPDF();
            
            let y = 15;
            const pageHeight = doc.internal.pageSize.height;
            const margin = 10;
            doc.setFontSize(18);
            doc.text("Charles Paris OP-1 Field Guide: Ultimate Edition", margin, y);
            y += 15;
            doc.setFontSize(10);
            doc.text("Master your Teenage Engineering OP-1 Field with this comprehensive guide by Charles Paris Music.", margin, y);
            y += 20;

            tipsData.forEach(tip => {
                if (y > pageHeight - 30) {
                    doc.addPage();
                    y = 15;
                }
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text(`${tip.title} (${categories[tip.category].name})`, margin, y);
                y += 7;
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                const descLines = doc.splitTextToSize(tip.description, doc.internal.pageSize.width - 2 * margin);
                doc.text(descLines, margin + 5, y);
                y += descLines.length * 5 + 5;
                if (tip.context) {
                    const contextLines = doc.splitTextToSize(`Context: ${tip.context}`, doc.internal.pageSize.width - 2 * margin);
                    doc.text(contextLines, margin + 5, y, { fontStyle: 'italic' });
                    y += contextLines.length * 5 + 5;
                }
                y += 5; // Extra space between tips
            });
            doc.save('op1-charles-paris-guide.pdf');
        };

        // --- EVENT LISTENERS ---
        closeModalButton.addEventListener('click', closeModal);
        tipModal.addEventListener('click', (e) => {
            if (e.target === tipModal) closeModal();
        });
        
        moreInfoButton.addEventListener('click', showDetailsView);
        backToTipButton.addEventListener('click', hideDetailsView);
        copyTipButton.addEventListener('click', () => {
            if (!currentTip) return;
            const textToCopy = `${currentTip.title}\n\n${currentTip.description}`;
            const textArea = document.createElement("textarea");
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            // Optional: Provide visual feedback that text was copied
            // Using alert for simplicity, replace with custom modal if desired
            // alert('Tip copied to clipboard!'); 
            const originalText = copyTipButton.innerHTML;
            copyTipButton.innerHTML = '<i class="fa-solid fa-check mr-2"></i> Copied!';
            setTimeout(() => {
                copyTipButton.innerHTML = originalText;
            }, 1500);
        });

        // Setup header modal toggles
        const setupModalToggle = (button, modal, closeButton, populateFn) => {
            button.addEventListener('click', () => {
                modal.classList.remove('hidden');
                if (populateFn) populateFn();
            });
            closeButton.addEventListener('click', () => modal.classList.add('hidden'));
            modal.addEventListener('click', (e) => {
                if(e.target === modal) modal.classList.add('hidden');
            });
        };

        setupModalToggle(op1LicksButton, op1LicksModal, closeOp1LicksModalButton, populateOp1Licks);
        setupModalToggle(effectsListButton, effectsListModal, closeEffectsListModalButton, populateEffectsList);
        setupModalToggle(sequencersButton, sequencersModal, closeSequencersModalButton, populateSequencers);
        setupModalToggle(shortcutsButton, shortcutsModal, closeShortcutsModalButton, populateShortcuts);

        // Search functionality for effects modal only
        effectsSearchInput.addEventListener('input', () => populateEffectsList(effectsSearchInput.value));

        downloadPdfButton.addEventListener('click', downloadPdf);

        // Initial display
        setupCategoryFilters();
        displayTips();
    });
    </script>
</body>
</html>
